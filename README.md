# GARtoExcel

## Описание

Программа для перевода адресных объектов от уровня домов и выше из формата ГАР в формат таблиц Excel. В файле properties настраиваются параметры обработки: перечень регионов, либо все регионы из архива, перечень уровней объектов, а также количество объектов домов на файл

Программа писалась под слабые компьютеры, поэтому в балансе между затратами оперативной памяти и скоростью работы предпочтение отдано первой. Вся работа с данными происходит в рамках DataFrame pandas, что позволяет снизить объём занимаемой памяти в ущерб быстродействию. Однако этот недостаток становится критическим только при включении в обработку домов

Работа с базой ГАР происходит непосредственно в архиве без какой-либо предварительной подготовки данных. База должна быть помещена в папку GAR\. Выходные данные помещаются в директорию Data\n\, где n - номер региона в архиве ГАР, и имеют вид таблиц Excel, по таблице на каждый уровень базы данных

Таблицы имеют следующий вид:
![image](https://user-images.githubusercontent.com/107953651/211736860-79c766ec-1745-4f59-a3a8-479e77f9a5db.png)

Административный и муниципальный адреса генерируются программой на основе соответствующих файлов иерархии и включают в том числе те уровни адресных объектов, которые исключены из выходных данных. Родительский объект, напротив, ссылается на ближайшего родителя, не исключённого из обработки

## Алгоритм

Программа последовательно считывает данные из файлов базы ГАР и записывает в датафреймы pandas: адресные объекты и дома, затем параметры адресных объектов. Параметры домов выносятся во временные текстовые файлы с пометкой в столбце датафрейма о номере временного файла. Чтение происходит с помощью ElementTree из библиотеки xml

Следующий шаг после чтения параметров - заполнение официальных и формальных наименований, а также поля AO_NAME для корректного импорта и построения связей в Creatio. Формальное наименование состоит из краткого наименования типа объекта и его названия, официальное наименование заполняется из соответствующего параметра. Если параметр не заполнен в базе, то в поле копируется формальное наименование. Поле AO_NAME состоит из идентификатора ObjectId / House Id и официального наименования, разделённых двоеточием. Это обеспечивает уникальность AO_NAME

Муниципальные и административные адреса заполняются по элементу PATH из файлов AS_ADM_HIERARCHY и AS_MUN_HIERARCHY. Поле AO_PARENT заполняется по административной иерархии с учётом исключённых из обработки уровней объектов

Формирование Excel таблиц производится средствами pandas и XlsxWriter. Каждый уровень адресных объектов фильтруется по AO_LEVEL, после чего таблица записывается в файл. Затем датафрейм обрезается до одних домов, и на этом этапе происходит подгрузка данных из временных файлов в соответствии и запись таблиц домов по частям с удалением обработанной части для освобождения памяти
